
<!DOCTYPE html>
<html>
<head>
  <title>Nairobi Hoods - Single Click</title>
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body {margin:0; font-family:Arial; background:#f0f4f8;}
    #controls {position:absolute; top:10px; left:10px; z-index:1000; background:white; padding:20px; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.2);}
    select {padding:12px; font-size:16px; border:2px solid #4099ff; border-radius:8px; width:280px;}
    #map {height:100vh;}
    .stats {margin-top:10px; font-size:14px; color:#666;}
  </style>
</head>
<body>
  <div id="controls">
    <label>üè† Select Neighborhood: 
      <select id="hood-select" onchange="showSelectedHood()">
        <option value="">All Nairobi (zoom out)</option>
      </select>
    </label>
    <div id="hood-stats" class="stats"></div>
  </div>
  <div id="map"></div>
  
  <script>
    var map = L.map("map").setView([-1.29, 36.82], 10);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
    
    var allHoodsData, currentLayer;
    
    fetch("hoods.geojson")
      .then(r => r.json())
      .then(data => {
        allHoodsData = data;
        var hoodLayer = L.geoJSON(data, {
          style: {color: "#888", weight: 2, fillOpacity: 0.1},
          onEachFeature: addHoodToDropdown
        }).addTo(map);
      });
    
    function addHoodToDropdown(feature, layer) {
      var hoodName = feature.properties.hood_name;
      if (!hoodName) return;
      
      var option = document.createElement("option");
      option.value = hoodName;
      option.textContent = hoodName;
      document.getElementById("hood-select").appendChild(option);
    }
    
    function showSelectedHood() {
      var selectedHood = document.getElementById("hood-select").value;
      
      // Clear previous
      if (currentLayer) map.removeLayer(currentLayer);
      
      if (!selectedHood) {
        // Show all
        currentLayer = L.geoJSON(allHoodsData, {
          style: {color: "#888", weight: 2, fillOpacity: 0.1}
        }).addTo(map);
        map.setView([-1.29, 36.82], 10);
        document.getElementById("hood-stats").innerHTML = "";
        return;
      }
      
      // Filter + highlight selected
      var selectedFeatures = allHoodsData.features.filter(f => 
        f.properties.hood_name === selectedHood
      );
      
      currentLayer = L.geoJSON({type: "FeatureCollection", features: selectedFeatures}, {
        style: {color: "#ff6b35", weight: 5, fillOpacity: 0.4},
        onEachFeature: function(feat, layer) {
          layer.bindPopup(`
            <b>${feat.properties.hood_name}</b><br>
            Blocks: ${feat.properties.n_blocks || "N/A"}<br>
            Size: ${feat.properties.dominant_size || "mixed"}<br>
            Income: ${feat.properties.Income_Level || "N/A"}
          `);
        }
      }).addTo(map);
      
      map.fitBounds(currentLayer.getBounds().pad(0.1));
      
      // Show stats
      var stats = selectedFeatures[0].properties;
      document.getElementById("hood-stats").innerHTML = `
        Blocks: ${stats.n_blocks}<br>
        Density: ${stats.int_density_km2?.toFixed(0)} int/km¬≤<br>
        Income: ${stats.Income_Level || stats.income_priority}
      `;
    }
  </script>
</body>
</html>
